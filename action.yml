name: 'Translate'
description: 'Automatic translation using GPT'
inputs:
  folder-to-translate:  # id of input
    description: 'Path to folder to translate'
    required: true
    default: 'docs/'
  language:  # id of input
    description: 'Language to translate to'
    required: true
    default: 'es'
  output-folder:
    description: "Output Folder"
    default: 'docs_translated/'
  max-chunk-tokens:
    description: "Max size of chunk to translate at once"
    default: "1000"
  config-folder:
    description: "Config Folder"
    default: './configs'
  filter-files:
    description: "What files to consider"
    default: "pr" 
outputs:
  translated-files:
    description: 'Translated files'
    value: ${{ steps.changed-files.outputs.changed_files }} 

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: ${{ github.event_name == 'pull_request' && 2 || 0 }}
    - name: Get changed files
      id: changed-files
      run: |
          if ${{ github.event_name == 'pull_request' }}; then
             echo "changed_files=$(git diff --name-only -r HEAD^1 HEAD | grep '\.md$' | xargs)" >> $GITHUB_OUTPUT
          else
              echo "changed_files=$(git diff --name-only ${{ github.event.before }} ${{ github.event.after }} | grep '\.md$' | xargs)" >> $GITHUB_OUTPUT
          fi
      shell: bash
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install gpt-translate
      shell: bash
    - name: translating files
      run: |
        if ${{ inputs.filter-files == 'pr' }}; then
            gpt_translate.files ${{ steps.changed-files.outputs.changed_files }} \
              --input_folder ${{ inputs.folder-to-translate }} \
              --out_folder ${{ inputs.output-folder }} \
              --language ${{ inputs.language }} \
              --max_chunk_tokens ${{ inputs.max-chunk-tokens }} \
              --config_folder ${{ inputs.config-folder }} \
              --replace ${{ inputs.replace }}
        else
            gpt_translate.folder ${{ inputs.folder-to-translate }} \
              --out_folder ${{ inputs.output-folder }} \ 
              --language ${{ inputs.language }} \
              --max_chunk_tokens ${{ inputs.max-chunk-tokens }} \
              --config_folder ${{ inputs.config-folder }} \
              --replace ${{ inputs.replace }}
        fi
      shell: bash