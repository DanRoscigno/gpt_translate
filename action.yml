name: 'Translate'
description: 'Automatic translation using GPT'
inputs:
  folder-to-translate:
    description: 'Path to folder to translate'
    required: true
    default: 'docs/'
  language:
    description: 'Language to translate to'
    required: true
    default: 'es'
  output-folder:
    description: "Output Folder"
    default: 'docs_translated/'
  config-folder:
    description: "Config Folder"
    default: './configs'
  weave-project:
    description: "Weave project name"
    required: false
    default: 'my_docs_translation'

outputs:
  translated-files:
    description: 'Translated files'
    value: ${{ steps.changed-files.outputs.changed_files }} 

runs:
  using: "composite"
  steps:
    - name: Get changed files
      id: changed-files
      run: |
        echo "changed_files=$(git diff --name-only -r HEAD^1 HEAD | grep '\.md$' | xargs)" >> $GITHUB_OUTPUT
      shell: bash
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install gpt-translate
      shell: bash
    - name: Create file list
      run: |
        echo "${{ steps.changed-files.outputs.changed_files }}" | tr ' ' '\n' > files_to_translate.txt
      shell: bash
    - name: Translating files
      run: |
        gpt_translate.files files_to_translate.txt \
          --input_folder ${{ inputs.folder-to-translate }} \
          --out_folder ${{ inputs.output-folder }} \
          --language ${{ inputs.language }} \
          --config_folder ${{ inputs.config-folder }} \
          --replace \
          --weave_project ${{ inputs.weave-project }}
      shell: bash